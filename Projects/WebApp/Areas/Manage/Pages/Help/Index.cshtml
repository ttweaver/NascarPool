@page
@model IndexModel
@{
    ViewData["Title"] = "Season Setup Guide";
}

<div class="container-fluid">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h1 class="mb-0"><i class="bi bi-info-circle me-2"></i>Season Setup Guide</h1>
        </div>
        <div class="card-body">
            <p class="lead">This guide will walk you through the complete process of setting up a new Fast Lap Fantasy season.</p>

            <!-- Step 1: Create the Pool -->
            <div class="mb-5">
                <h2 class="text-primary mb-3">
                    <span class="badge bg-primary me-2">1</span>Create the Pool
                </h2>
                <div class="card">
                    <div class="card-body">
                        <p class="mb-3">The pool represents a season in your Fast Lap Fantasy application.</p>
                        <ol class="mb-3">
                            <li>Navigate to <strong>Pools</strong> from the Manager Mode menu</li>
                            <li>Click the <span class="badge bg-primary">Create New</span> button</li>
                            <li>Enter the <strong>Name</strong> (e.g., "2026 Season")</li>
                            <li>Enter the <strong>Year</strong> (e.g., 2026)</li>
                            <li>Click <span class="badge bg-success">Create</span></li>
                        </ol>
                        <div class="alert alert-info mb-0">
                            <i class="bi bi-lightbulb me-2"></i>
                            <strong>Tip:</strong> Use a consistent naming convention like "YEAR Season" to keep your pools organized. Each pool is independent and can have its own drivers, races, and members.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Add Drivers -->
            <div class="mb-5">
                <h2 class="text-primary mb-3">
                    <span class="badge bg-primary me-2">2</span>Add Drivers
                </h2>
                <div class="card">
                    <div class="card-body">
                        <p class="mb-3">Add all drivers participating in the season to your pool.</p>
                        <ol class="mb-3">
                            <li>Navigate to <strong>Drivers</strong> from the Manager Mode menu</li>
                            <li>Use the pool selector at the top of the page to switch to your newly created pool</li>
                            <li>Click <span class="badge bg-primary">Create New</span></li>
                            <li>Enter the driver's <strong>Name</strong> and <strong>Car Number</strong></li>
                            <li>The driver will automatically be assigned to the currently selected pool</li>
                            <li>Click <span class="badge bg-success">Create</span></li>
                            <li>Repeat for all drivers in the season</li>
                        </ol>
                        <div class="alert alert-warning mb-0">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            <strong>Important:</strong> Drivers are pool-specific. Each season needs its own driver list. Make sure the correct pool is selected before adding drivers.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Add Races -->
            <div class="mb-5">
                <h2 class="text-primary mb-3">
                    <span class="badge bg-primary me-2">3</span>Add Races
                </h2>
                <div class="card">
                    <div class="card-body">
                        <p class="mb-3">Add all races scheduled for the season.</p>
                        <ol class="mb-3">
                            <li>Navigate to <strong>Races</strong> from the Manager Mode menu</li>
                            <li>Use the pool selector to switch to your newly created pool</li>
                            <li>Click <span class="badge bg-primary">Create New</span></li>
                            <li>Enter the race details:
                                <ul>
                                    <li><strong>Name</strong> (e.g., "Daytona 500")</li>
                                    <li><strong>Date</strong> (race date)</li>
                                    <li><strong>City</strong> (e.g., "Daytona Beach")</li>
                                    <li><strong>State</strong> (select from dropdown)</li>
                                </ul>
                            </li>
                            <li>The race will automatically be assigned to the currently selected pool</li>
                            <li>Click <span class="badge bg-success">Create</span></li>
                            <li>Repeat for all races in the season</li>
                        </ol>
                        <div class="alert alert-info mb-0">
                            <i class="bi bi-lightbulb me-2"></i>
                            <strong>Tip:</strong> Add races in chronological order to make the schedule easier to manage. Races are automatically sorted by date in most views.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Manage Allowed Users -->
            <div class="mb-5">
                <h2 class="text-primary mb-3">
                    <span class="badge bg-primary me-2">4</span>Manage Allowed Users
                </h2>
                <div class="card">
                    <div class="card-body">
                        <p class="mb-3">Define which users can register for your application.</p>
                        <ol class="mb-3">
                            <li>Navigate to <strong>Allowed Users</strong> from the Manager Mode menu</li>
                            <li>Click <span class="badge bg-primary">Add New</span></li>
                            <li>Enter the user's information:
                                <ul>
                                    <li><strong>First Name</strong></li>
                                    <li><strong>Last Name</strong></li>
                                    <li><strong>Email</strong></li>
                                </ul>
                            </li>
                            <li>Click <span class="badge bg-success">Create</span></li>
                            <li>Repeat for all participants</li>
                        </ol>
                        <div class="alert alert-warning mb-0">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            <strong>Note:</strong> Only users added to this list will be able to register. They must use the exact first name, last name, and email address you specify here when creating their account.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 5: Add Players to Pool -->
            <div class="mb-5">
                <h2 class="text-primary mb-3">
                    <span class="badge bg-primary me-2">5</span>Add Players to Pool
                </h2>
                <div class="card">
                    <div class="card-body">
                        <p class="mb-3">After users have registered, add them as members of the pool.</p>
                        <ol class="mb-3">
                            <li>Navigate to <strong>Pools</strong> from the Manager Mode menu</li>
                            <li>Find your pool and click <span class="badge bg-info"><i class="bi bi-people"></i> Update Members</span></li>
                            <li>Select all registered users who should participate in this pool</li>
                            <li>Click <span class="badge bg-success">Save</span></li>
                        </ol>
                        <div class="alert alert-info mb-0">
                            <i class="bi bi-lightbulb me-2"></i>
                            <strong>Tip:</strong> Players must be registered users before they can be added to a pool. Users can be members of multiple pools (multiple seasons) simultaneously.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 6: Players Make Picks -->
            <div class="mb-5">
                <h2 class="text-primary mb-3">
                    <span class="badge bg-primary me-2">6</span>Players Make Picks
                </h2>
                <div class="card">
                    <div class="card-body">
                        <p class="mb-3">Once the pool is set up, players can make their picks.</p>
                        <h5 class="mb-3">Player Actions:</h5>
                        <ol class="mb-3">
                            <li>Each player logs into their account in <strong>Player Mode</strong></li>
                            <li>Use the pool selector to switch between seasons they're a member of</li>
                            <li>On the <strong>Dashboard</strong>, they can:
                                <ul>
                                    <li>Select their <strong>Primary Driver</strong> for the first half of the season</li>
                                    <li>Select their <strong>Primary Driver</strong> for the second half of the season (when available)</li>
                                </ul>
                            </li>
                            <li>For each upcoming race, they make three picks before the race date:
                                <ul>
                                    <li><strong>Pick 1:</strong> Their primary driver (automatically selected)</li>
                                    <li><strong>Pick 2:</strong> Their second choice driver</li>
                                    <li><strong>Pick 3:</strong> Their third choice driver</li>
                                </ul>
                            </li>
                            <li>Picks can be changed any time before the race day</li>
                        </ol>
                        <div class="alert alert-success mb-0">
                            <i class="bi bi-check-circle me-2"></i>
                            <strong>Scoring:</strong> Lower points are better (like golf). Points are calculated as the absolute difference between predicted and actual finishing positions. For example, if you pick a driver to finish 1st and they finish 5th, you get 4 points.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 7: Enter Race Results -->
            <div class="mb-5">
                <h2 class="text-primary mb-3">
                    <span class="badge bg-primary me-2">7</span>Enter Race Results
                </h2>
                <div class="card">
                    <div class="card-body">
                        <p class="mb-3">After each race, administrators enter the results to calculate player scores.</p>
                        <ol class="mb-3">
                            <li>Navigate to <strong>Races</strong> from the Manager Mode menu</li>
                            <li>Find the completed race in the list</li>
                            <li>Click <span class="badge bg-warning"><i class="bi bi-pencil"></i> Enter Results</span></li>
                            <li>Enter the finishing place for each driver</li>
                            <li>Click <span class="badge bg-success">Save Results</span></li>
                            <li>A success notification will confirm the save and show how many picks were recalculated</li>
                        </ol>
                        <div class="alert alert-warning mb-0">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            <strong>Important:</strong> Points are automatically calculated when you save results. The system will:
                            <ul class="mb-0 mt-2">
                                <li>Calculate points for all players' picks for that race</li>
                                <li>Update standings automatically</li>
                                <li>Handle ties correctly (players with equal points receive the same place)</li>
                                <li>Skip place numbers after ties (e.g., if two players tie for 1st, the next player is 3rd)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Managing Users -->
            <div class="mb-5">
                <h2 class="text-primary mb-3">
                    <i class="bi bi-people me-2"></i>Managing Users & Players
                </h2>
                <div class="card">
                    <div class="card-body">
                        <h5 class="mb-3">User vs Player Management:</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="card bg-light h-100">
                                    <div class="card-body">
                                        <h6 class="card-title"><strong>Users</strong> (Manager &gt; Users)</h6>
                                        <p class="small">Manage all system users <strong>regardless of pool</strong>:</p>
                                        <ul class="small mb-0">
                                            <li>View all registered users across all pools</li>
                                            <li>Edit user information (name, email, player status)</li>
                                            <li>See which pools each user belongs to</li>
                                            <li>Manage primary drivers for any pool</li>
                                            <li>Set player status (IsPlayer flag)</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card bg-light h-100">
                                    <div class="card-body">
                                        <h6 class="card-title"><strong>Players</strong> (Manager &gt; Players)</h6>
                                        <p class="small">View player-specific information <strong>for selected pool</strong>:</p>
                                        <ul class="small mb-0">
                                            <li>View only players in currently selected pool</li>
                                            <li>See primary driver assignments for current pool</li>
                                            <li>Quick access to pool-specific player stats</li>
                                            <li>Filtered view for easier pool management</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="alert alert-info mt-3 mb-0">
                            <i class="bi bi-lightbulb me-2"></i>
                            <strong>When to use which:</strong> Use <strong>Users</strong> for global user management tasks (editing user info, seeing all users). Use <strong>Players</strong> when you need a pool-specific view of participants.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Reference -->
            <div class="mb-4">
                <h2 class="text-primary mb-3">
                    <i class="bi bi-bookmark me-2"></i>Quick Reference
                </h2>
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Setup Order:</h5>
                                <ol class="mb-3">
                                    <li>Create Pool</li>
                                    <li>Add Drivers to Pool</li>
                                    <li>Add Races to Pool</li>
                                    <li>Manage Allowed Users (if not done)</li>
                                    <li>Wait for users to register</li>
                                    <li>Add Players to Pool</li>
                                </ol>
                            </div>
                            <div class="col-md-6">
                                <h5>During Season:</h5>
                                <ul class="mb-3">
                                    <li>Players select primary drivers</li>
                                    <li>Players make picks before each race</li>
                                    <li>Enter results after each race</li>
                                    <li>View standings (ties handled automatically)</li>
                                    <li>System calculates points automatically</li>
                                </ul>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <h5>Key Features:</h5>
                                <ul class="mb-0">
                                    <li><strong>Pool Selector:</strong> Top of page in both Player and Manager modes - always shows which pool you're working with</li>
                                    <li><strong>Scoring:</strong> Lower points = better (golf scoring system)</li>
                                    <li><strong>Ties:</strong> Players with equal points get the same rank; subsequent places are skipped</li>
                                    <li><strong>Mode Toggle:</strong> Admins can switch between Player and Manager modes using the button in the navigation bar</li>
                                    <li><strong>Pool Independence:</strong> Each pool has its own drivers, races, and member list</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Best Practices -->
            <div class="mb-0">
                <h2 class="text-primary mb-3">
                    <i class="bi bi-star me-2"></i>Best Practices
                </h2>
                <div class="card border-success">
                    <div class="card-body">
                        <ul class="mb-0">
                            <li class="mb-2"><strong>Complete setup before the season starts:</strong> Have all drivers, races, and players added before the first race to avoid confusion.</li>
                            <li class="mb-2"><strong>Use the pool selector:</strong> Always verify you're working with the correct pool when adding drivers and races. The pool selector is your friend!</li>
                            <li class="mb-2"><strong>Consistent naming:</strong> Use consistent naming conventions for pools (e.g., "2026 Season", "2027 Season").</li>
                            <li class="mb-2"><strong>User vs Player management:</strong> 
                                <ul>
                                    <li>Use <strong>Users</strong> for global user management (editing accounts, viewing all users)</li>
                                    <li>Use <strong>Players</strong> for pool-specific views (seeing who's in a particular season)</li>
                                </ul>
                            </li>
                            <li class="mb-2"><strong>Test the system:</strong> Create a test pool and walk through the entire process before your actual season starts.</li>
                            <li class="mb-2"><strong>Communicate with players:</strong> Send reminders about:
                                <ul>
                                    <li>Registration deadlines</li>
                                    <li>Primary driver selection deadlines (before first race and at season midpoint)</li>
                                    <li>Race dates and pick deadlines (picks must be in before race day)</li>
                                    <li>How the scoring system works (lower is better)</li>
                                </ul>
                            </li>
                            <li class="mb-2"><strong>Regular updates:</strong> Enter race results promptly after each race so players can track their standings and performance.</li>
                            <li class="mb-2"><strong>Backup data:</strong> Regularly backup your database, especially before major updates or when starting a new season.</li>
                            <li class="mb-2"><strong>Multiple seasons:</strong> You can run multiple pools simultaneously (e.g., running 2026 season while keeping 2025 data available for reference).</li>
                            <li class="mb-2"><strong>Allowed Users list:</strong> Keep this list updated. Users must match exactly (first name, last name, and email) to register successfully.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <button type="button" class="btn btn-secondary" onclick="history.back()">
                <i class="bi bi-arrow-left"></i> Back
            </button>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
}